---
keywords:
  - Coyoneda
  - Haskell
---

# Coyoneda ã£ã¦â€¦â€¦ ãŠå‰ functor ãŒãƒ‡ãƒ¼ã‚¿æ§‹é€ ã«ãªã£ãŸã ã‘ã‚„ã‚“ã‘ï¼ï¼

[operational](https://wiki.haskell.org/Operational) (ã‚ã‚‹ã„ã¯ freer) ã¨å‘¼ã°ã‚Œã¦ã„ã‚‹ã‚‚ã®ã®èª¬æ˜ã¨ã—ã¦ï¼Œ

- a) `Coyoneda` ã‚’ä½¿ã†ã¨ï¼Œkind ãŒ `* -> *` ã§ã‚ã‚‹ã‚ˆã†ãªä»»æ„ã®å‹ã‹ã‚‰ functor ã‚’ä½œã‚Šå‡ºã›ã‚‹
  - ä»»æ„ã®å‹ `f :: * -> *` ã«ã¤ã„ã¦ `Coyoneda f` ã¯ `Functor` ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ãªã‚‹
- b) `Free` ã‚’ä½¿ã†ã¨ï¼Œä»»æ„ã® functor ã‹ã‚‰ monad ã‚’ä½œã‚Šå‡ºã›ã‚‹
  - `Functor` ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ã‚ã‚‹ä»»æ„ã®å‹ `f` ã«ã¤ã„ã¦ `Free f` ã¯ `Monad` ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ãªã‚‹
- a ã¨ b ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã¨ï¼Œé©å½“ãªå‹ `f :: * -> *` ã‹ã‚‰ monad ã‚’ä½œã‚Šå‡ºã›ã¦ä¾¿åˆ©ã€œğŸ™Œ

ã¨ã„ã†ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãŒå¾€ã€…ã«ã—ã¦èªã‚‰ã‚Œã‚‹[^1]ï¼

---

Free ã«ã¤ã„ã¦ã¯æ—¢ã«å¤šãã®è§£èª¬ãŒå­˜åœ¨ã™ã‚‹ã®ã§ï¼Œè©³ã—ã„è§£èª¬ã¯ä»–ã®è¨˜äº‹ã‚’ã‚ãŸã£ã¦ã‚‚ã‚‰ã†ã“ã¨ã¨ã—ã¦ï¼Œã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒãƒ«ãªèª¬æ˜ã‚’ã—ã¦ãŠãã¨ï¼Œä»¥ä¸‹ã®ã‚ˆã†ãªæ°—æŒã¡ã‚’æŒã£ãŸãƒ‡ãƒ¼ã‚¿æ§‹é€ ã§ã‚ã‚‹ï¼

- a) monad ã‚’ç‰¹å¾´ä»˜ã‘ã‚‹ã®ã¯ `fmap` + `pure` + `join` ã§ã‚ã‚‹
- b) `data Free f a = Pure a | Join (f (Free f a))` ã¨å®šç¾©ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¯ï¼Œãã®æ§‹é€ å†…ã« `pure` ã¨ `join` ã‚’å†…åŒ…ã—ã¦ã„ã‚‹
  - å®Ÿéš›ï¼Œ
    - `Pure :: a -> Free f a`
    - `Join :: f (Free f a) -> Free f a`
- a ã¨ b ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã¨ï¼Œ`f` ãŒ functor ã§ã‚ã‚‹ (`fmap` ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹) ã¨ãã«ï¼Œ`Free f a` ã¯ `fmap` `pure` `join` ã‚’å‚™ãˆã¦ã„ã‚‹ã®ã§ monad ã¨è¨€ã£ã¦ã‚‚éè¨€ã§ã¯ãªã„ğŸ‘

è£œè¶³: `Join` ã¨ã„ã†ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¯ï¼Œå ´åˆã«ã‚ˆã£ã¦ã¯ `Free` ã ã¨ã‹ `Impure` ã ã¨ã‹æ›¸ã‹ã‚Œã‚‹å ´åˆãŒã‚ã‚‹ãŒï¼Œã“ã‚ŒãŒã¾ã•ã« `Join` ã¨åä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹ã“ã¨ãŒï¼Œç§ã®(ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒãƒ«ãª)ç†è§£ã®æ‰‹åŠ©ã‘ã«ãªã£ãŸï¼äººã€…ã¯è¦ªåˆ‡ãªãƒãƒ¼ãƒŸãƒ³ã‚°ã‚’å¿ƒæ›ã‘ã¦ã»ã—ã„ï¼

ç¹°ã‚Šè¿”ã—ã«ãªã‚‹ãŒï¼Œä»¥ä¸Šã¯ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒãƒ«ãªæ°—æŒã¡ã§ã‚ã‚‹ï¼ãƒ•ã‚©ãƒ¼ãƒãƒ«ãªèª¬æ˜ã‚’æ±‚ã‚ã‚‹ã¨ï¼Œmonad ã‹ã‚‰ functor ã¸ã®å¿˜å´é–¢æ‰‹ã®å·¦éšä¼´ã ã¨ã‹ä½•ã¨ã‹è¨€ã‚ã‚Œã¦ï¼Œã‚‚ã†å‹˜å¼ã—ã¦ãã‚Œã¨ã„ã†æ°—æŒã¡ã«ãªã‚‹ã®ã§ï¼ŒãŠè¿‘ãã®åœè«–ã«è©³ã—ã„æ–¹ã«èã„ã¦ãã ã•ã„ï¼

`Free f a` ãŒ (`f` ãŒ functor ã§ã‚ã‚‹ã¨ãã«) monad ã«ãªã‚Šãã†ã ã¨ã„ã†ã“ã¨ã¯ã‚ã‹ã£ãŸã®ã§ï¼Œæ¬¡ã¯ `Coyoneda` ã‚’è¦‹ã¦ã¿ã‚ˆã†ï¼

```haskell
 data Coyoneda f a = forall x. Coyoneda (x -> a) (f x)
```

æœ€åˆã«è¦‹ãŸã¨ãã¯ï¼Œã“ã„ã¤ãŒ functor ã«ãªã‚‹ã¨è¨€ã‚ã‚Œã¦ã‚‚æ„å‘³ä¸æ˜ã ã£ãŸãŒï¼Œå°‘ã—æ›¸ãæ›ãˆã‚‹ã¨ç†è§£ã®åŠ©ã‘ã«ãªã‚‹ï¼`a` ã‚’ `b` ã«ï¼Œ`x` ã‚’ `a` ã«ç½®ãæ›ãˆã¦ã¿ã‚‹ã¨ï¼Œ

```haskell
data Coyoneda f b = forall a. Coyoneda (a -> b) (f a)
```

GADT ã§æ›¸ã‘ã°[^2]ï¼Œ

```haskell
data Coyoneda f b where
    Coyoneda :: (a -> b) -> f a -> Coyoneda f b
```

**ã„ã‚„ã„ã‚„ã„ã‚„ï¼ŒãŠå‰ã»ã¼ `fmap :: (a -> b) -> f a -> f b` ã‚„ã‚“ã‘ï¼ï¼ï¼**

ã¨ã„ã†ã‚ã‘ã§ï¼ŒCoyoneda ã®ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒãƒ«ãªæ°—æŒã¡ã¨ã—ã¦ã¯ï¼Œ`Free` ãŒè‡ªèº«ã« monad ã£ã½ã¿ã‚’å†…åŒ…ã—ã¦ã„ã‚‹ãŒæ•…ã« monad ã¨ã—ã¦æŒ¯ã‚‹èˆãˆã‚‹ã®ã¨åŒæ§˜ã«ï¼Œ`Coyoneda` ã¯è‡ªèº«ã« functor ã£ã½ã¿ã‚’å†…åŒ…ã—ã¦ã„ã‚‹ãŒæ•…ã« functor ã¨ã—ã¦æŒ¯ã‚‹èˆãˆã‚‹ã®ã§ã‚ã£ãŸï¼

ã‚‚ã¡ã‚ã‚“ï¼Œãƒ‡ãƒ¼ã‚¿æ§‹é€ ãã‚Œè‡ªèº«ãŒã€Œfunctor ã£ã½ã„ã€ã‹ã‚‰ã¨ã„ã£ã¦ï¼Œæœ¬å½“ã« functor ã¨ã—ã¦æŒ¯ã‚‹èˆã†ã®ã‹ã¯è‡ªæ˜ã§ã¯ãªã„ãŒï¼Œç±³ç”°ã®è£œé¡Œã«ã‚ˆã£ã¦ä¿è¨¼ã•ã‚Œã‚‹ï¼Œã‚‰ã—ã„ï¼è©³ã—ãã¯ãŠè¿‘ãã®åœè«–ã«è©³ã—ã„æ–¹ã«èã„ã¦ãã ã•ã„ï¼

å®Ÿéš›ï¼Œ

```haskell
foo :: Functor f => Coyoneda f a -> f a
foo (Coyoneda f x) = f <$> x

bar :: f a -> Coyoneda f a
bar x = Coyoneda id x
```

ã¨ç½®ãã¨ï¼Œ

```haskell
foo . bar == id
bar . foo == id
```

ã¨å…¨å˜å°„ãŒå­˜åœ¨ã—ã¦å®‰å¿ƒï¼

free monad ã¯ monad ãŒæŒã¤æ€§è³ªã‚’ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã§è¡¨ç¾ã—ãŸã‚‚ã®ã§ã‚ã‚‹ã“ã¨ã¨åŒæ§˜ã«ï¼ŒCoyoneda ã¯ functor ãŒæŒã¤æ€§è³ªã‚’ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã§è¡¨ç¾ã—ãŸã‚‚ã®ã§ã‚ã‚‹ã“ã¨ã‚’è¦‹ãŸï¼ã“ã‚Œã¯ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒãƒ«ã«ã¯ free functor ã¨ã§ã‚‚å‘¼ã‚“ã§ã„ã„æ§‹é€ ã‹ã‚‚ã—ã‚Œãªã„[^3]ï¼åŒã˜ã‚ˆã†ã«ã—ã¦ï¼Œfree applicative functor ãªã‚‹æ§‹é€ ã‚‚è€ƒãˆã‚‹ã“ã¨ãŒã§ããã†ã ï¼

```haskell
data FreeApplicative f b
    = Pure b
    | forall a. Ap (f (a -> b)) (FreeApplicative f a)
```

ã¨å®šç¾©ã™ã‚‹ã¨ï¼Œä»¥ä¸‹ã®ã‚ˆã†ãªå¯¾å¿œãŒå–ã‚Œã‚‹ï¼

| applicative                      | free applicative                                                 |
| -------------------------------- | ---------------------------------------------------------------- |
| `pure :: b -> f b`               | `Pure :: b -> FreeApplicative f b`                               |
| `ap :: f (a -> b) -> f a -> f b` | `Ap :: f (a -> b) -> FreeApplicative f a -> FreeApplicative f b` |

GADT ãªã‚‰ã“ã‚Œã‚’ç›´æ¥æ›¸ãä¸‹ã—ã¦å®šç¾©ã¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ï¼

```haskell
data FreeApplicative f b where
    Pure :: b -> FreeApplicative f b
    Ap :: f (a -> b) -> FreeApplicative f a -> FreeApplicative f b
```

free applicative ãŒä½•ã®å½¹ã«ç«‹ã¤ã®ã‹ã¯çŸ¥ã‚‰ãªã„ãŒï¼ŒarXiv ã§è«–æ–‡ã‚’è¦‹ã‹ã‘ãŸæ°—ãŒã™ã‚‹ï¼ãã‚‚ãã‚‚ Day convolution ã¨ã¯ãªã‚“ã§ã™ã‹ï¼

## è„šæ³¨

[^1]: å°‘ãªãã¨ã‚‚2å¹´ãã‚‰ã„å‰ã« lotz å…ˆç”Ÿã«èã„ãŸã¨ãã¯ãã†ã ã£ãŸï¼
[^2]: å®Ÿéš› [kan-extensions](https://hackage.haskell.org/package/kan-extensions/) ã§ã¯ [GADT ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹](https://hackage.haskell.org/package/kan-extensions-5.1/docs/src/Data-Functor-Coyoneda.html#Coyoneda)
[^3]: å®Ÿéš›ã« free functor ã¨å‘¼ã°ã‚Œã‚‹ã‚‚ã®ã«ã¤ã„ã¦ã¯ [nLab](https://ncatlab.org/nlab/show/free+functor) ãªã©ã‚’å‚ç…§ï¼
